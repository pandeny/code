# 负荷预测可解释性功能使用指南

## 概述

本系统已完整实现负荷预测结果的可解释性分析功能！您可以通过以下方式了解预测结果背后的原因和影响因素。

## ✨ 已实现的可解释性功能

### 1. 🔍 智能负荷阶段划分
- 使用隐马尔可夫模型(HMM)自动识别负荷变化的不同阶段
- 每个阶段代表不同的用电模式（如早高峰、白天、晚高峰、夜间等）
- 自动计算每个阶段的平均负荷水平

### 2. 📊 阶段特征分析
- **负荷水平分类**：低负荷、中低负荷、中高负荷、高负荷
- **时间特征**：识别早高峰、白天、晚高峰、夜间等时段
- **环境因素影响**：分析温度、湿度、云量等环境因素对负荷的影响
- **关键影响因素**：自动识别并列出每个阶段的主要影响因素

### 3. 📈 趋势变化解释
- 分析相邻阶段间的负荷变化率
- 判断变化趋势：稳定、上升、下降、显著变化
- 提供变化原因的自然语言解释
- 关联时间段和用户行为模式

### 4. 🎯 特征重要性分析
- 计算环境特征与负荷的相关性
- 识别最重要的影响因素
- 量化评估各因素的影响程度

### 5. 📝 自动报告生成
- 生成详细的文本分析报告
- 生成可视化分析图表
- 导出JSON格式的结构化数据

## 🚀 使用方法

### 方式一：在预测系统中自动生成（推荐）

运行预测系统时，可解释性分析会自动生成：

```bash
python train_household_forecast.py
# 选择 "预测模式"
# 选择要预测的日期
# 系统会自动生成以下文件：
```

**自动生成的输出文件：**

1. `prediction_with_stages_YYYYMMDD.png` - 预测结果与阶段划分可视化图
2. `explanation_report_YYYYMMDD.txt` - 详细的可解释性分析报告（文本格式）
3. `explanation_viz_YYYYMMDD.png` - 可解释性分析可视化图表
4. `explanation_YYYYMMDD.json` - 可解释性分析数据（JSON格式，便于程序读取）

### 方式二：运行独立的演示程序

查看可解释性功能的演示：

```bash
python load_interpretability_demo.py
```

这会生成：
- 演示数据的负荷分析
- 阶段划分结果
- 详细的解释报告
- 可视化图表

## 📖 输出文件说明

### 1. 可解释性分析报告 (explanation_report_YYYYMMDD.txt)

包含以下内容：

```
【阶段详细分析】
- 每个阶段的时间范围
- 负荷水平（低/中低/中高/高）
- 关键影响因素列表

【阶段间趋势变化分析】
- 阶段转换时的负荷变化量和变化率
- 变化趋势判断
- 变化原因解释

【特征重要性分析】
- 环境特征与负荷的相关性
- 最重要影响因素排序

【环境因素综合影响】
- 各环境因素的统计特征
- 异常环境条件识别
```

### 2. 可视化分析图 (explanation_viz_YYYYMMDD.png)

包含6个子图：
1. 阶段负荷水平柱状图
2. 阶段间趋势变化率图
3. 特征重要性排序图
4. 环境因素影响雷达图
5. 负荷曲线与阶段划分图
6. 负荷分布直方图

### 3. JSON数据文件 (explanation_YYYYMMDD.json)

结构化的可解释性数据，包含：
```json
{
  "segment_analysis": [
    {
      "segment_id": 1,
      "start_time": 0.0,
      "end_time": 6.0,
      "load_level": "低负荷",
      "mean_load": 0.5,
      "key_factors": [...]
    }
  ],
  "trend_analysis": {...},
  "feature_importance": {...},
  "environmental_impact": {...}
}
```

## 💡 使用示例

### 示例1：查看某天的预测解释

```bash
# 1. 运行预测系统
python train_household_forecast.py

# 2. 选择预测模式
# 3. 选择日期（如 2015-03-15）
# 4. 查看输出目录中的分析报告
```

### 示例2：理解负荷变化原因

查看生成的 `explanation_report_YYYYMMDD.txt` 文件，您会看到类似这样的解释：

```
阶段 1:
  时间范围: 0.0h - 6.0h (持续 6.00小时)
  负荷水平: 低负荷 (平均值: 0.4523)
  关键影响因素:
    • 夜间时段 - 睡眠、待机负荷
    • 低温(8.5°C)可能增加供暖负荷
    • 负荷相对稳定(标准差=0.023)

阶段 1 → 阶段 2:
  变化趋势: 显著上升
  负荷变化: +1.85 kW (+409.3%)
  变化原因:
    • 负荷大幅增加409.3%
    • 进入早晨时段，家庭活动增加
```

## 🔧 技术细节

### 核心算法
- **HMM（隐马尔可夫模型）**：用于负荷阶段智能划分
- **相关性分析**：计算环境特征与负荷的皮尔逊相关系数
- **自然语言生成**：基于规则生成易懂的解释文本

### 环境特征
支持的环境特征包括：
- 温度 (temperature)
- 湿度 (humidity)
- 云量 (cloudCover)
- 能见度 (visibility)
- 气压 (pressure)
- 风速 (windSpeed)
- 露点温度 (dewPoint)

## ❓ 常见问题

### Q1: 为什么我没有看到可解释性报告？
A: 确保您运行的是预测模式，并且预测成功完成。报告会自动保存在输出目录中。

### Q2: 如何找到输出文件？
A: 输出文件保存在 `ANALYSIS_OUTPUT_DIR/模型名称/predictions/` 目录下。

### Q3: 可以自定义可解释性分析吗？
A: 可以！编辑 `train_household_forecast.py` 中的 `explain_load_changes()` 函数即可添加自定义分析逻辑。

### Q4: 报告是中文还是英文？
A: 默认生成中文报告。可通过修改代码中的文本模板来改变语言。

## 📚 相关文档

- [可解释性模型详细文档](INTERPRETABILITY_MODEL.md)
- [实现总结](IMPLEMENTATION_SUMMARY.md)
- [快速参考](QUICK_REFERENCE.md)
- [主README](README.md)

## 💬 反馈与支持

如果您有任何问题或建议，欢迎提出Issue或Pull Request！

---

**注意**：可解释性功能已完全集成到系统中，无需额外配置即可使用！
