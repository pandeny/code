# 预测模式使用示例 - 多历史时期对比分析

## 使用场景

假设您已经训练好了一个LSTM模型，现在想要预测2024年1月14日（周日）的家庭负荷，并了解：

1. 预测负荷与历史负荷的差异
2. 负荷阶段是否发生了时间偏移
3. 负荷水平的增减原因
4. 这些变化反映了什么样的用电行为

## 操作步骤

### 1. 启动程序

```bash
python train_household_forecast.py
```

### 2. 选择预测模式

```
🏠 家庭负荷预测系统
============================================================
请选择运行模式：
1. 训练模式 - 训练新的LSTM模型
2. 预测模式 - 使用已保存的模型进行预测

请输入选择 (1/2): 2
```

### 3. 选择模型

系统会列出所有已保存的模型，选择要使用的模型：

```
🔮 预测模式
============================================================

可用的模型列表:
1. household_Apt1_lstm (数据: Apt1_2015.csv)
2. household_Apt2_lstm (数据: Apt2_2015.csv)

请选择模型 (输入序号): 1
```

### 4. 选择预测日期

输入要预测的日期：

```
请输入要预测的日期 (格式: YYYY-MM-DD): 2024-01-14
```

### 5. 系统自动执行

系统会自动执行以下步骤：

```
🎯 开始预测指定日期...
   预测日期: 2024-01-14

✅ 成功预测 96 个时间点的负荷值

🔄 正在进行HMM负荷阶段划分...
✅ HMM划分完成：识别出 5 个负荷阶段
   阶段 1: 00.00h-10.00h, 状态=0, 平均负荷=0.721
   阶段 2: 10.00h-14.25h, 状态=2, 平均负荷=1.817
   阶段 3: 14.25h-16.50h, 状态=1, 平均负荷=1.788
   阶段 4: 16.50h-18.75h, 状态=2, 平均负荷=1.839
   阶段 5: 18.75h-24.00h, 状态=3, 平均负荷=2.930

🔍 生成负荷变化可解释性分析...

📊 负荷变化解释摘要:
   阶段1: 低负荷 (0.0h-10.0h)
      关键因素: 夜间时段 - 睡眠、待机负荷
   阶段2: 中高负荷 (10.0h-14.2h)
      关键因素: 上午时段 - 日常活动、家务
   ...

🔍 开始多历史时期负荷对比分析...
✅ 成功准备1天前(2024-01-13)的历史数据，识别出4个阶段
✅ 成功准备3天前(2024-01-11)的历史数据，识别出4个阶段
✅ 成功准备7天前(2024-01-07)的历史数据，识别出6个阶段
✅ 多历史时期对比分析完成，报告已保存

📊 多历史时期对比摘要:
   • 与过去[1, 3, 7]天相比，负荷阶段持续右移(推迟)，说明作息时间逐渐推迟
   • 与历史时期相比，负荷整体呈上升趋势，可能原因：在家时间增加、新增用电设备
   • 与3天前(工作日)相比，早高峰右移约2小时，可能是周末起床时间推迟

🎉 预测完成！
```

### 6. 查看结果

系统会生成以下文件：

```
output/analysis/household_Apt1_lstm/predictions/
├── prediction_with_stages_20240114.png           # 预测图（含阶段划分）
├── prediction_detail_20240114.csv                # 详细预测数据
├── prediction_summary_20240114.csv               # 预测汇总
├── explanation_report_20240114.txt               # 可解释性报告
├── explanation_viz_20240114.png                  # 可解释性可视化
├── explanation_20240114.json                     # 可解释性数据(JSON)
├── multi_historical_comparison_20240114.txt      # 多历史时期对比报告 ⭐
└── multi_historical_comparison_20240114.json     # 对比数据(JSON) ⭐
```

## 报告内容详解

### 多历史时期对比报告示例

打开 `multi_historical_comparison_20240114.txt`，您会看到：

#### 1. 阶段数量变化趋势

```
【1】阶段数量变化趋势
--------------------------------------------------------------------------------

与1天前相比:
  预测日阶段数: 5
  历史阶段数: 4
  变化: +1 个阶段 (+25.0%)

与3天前相比:
  预测日阶段数: 5
  历史阶段数: 4
  变化: +1 个阶段 (+25.0%)

与7天前相比:
  预测日阶段数: 5
  历史阶段数: 6
  变化: -1 个阶段 (-16.7%)
```

**解读：**
- 与1天前和3天前相比，阶段数增加，说明用电行为更多样化
- 与7天前（也是周日）相比，阶段数略有减少，可能是用电模式略有变化

#### 2. 与3天前（工作日）的详细对比

```
================================================================================
【与3天前的详细对比】
================================================================================

▶ 阶段数量对比:
  当前阶段数: 5
  历史阶段数: 4
  变化趋势: 增加
  原因分析:
    负荷阶段数增加1个，可能原因：
      1. 用电行为更加多样化，出现更多负荷切换
      2. 家庭成员活动模式发生变化
      3. 新增用电设备或改变使用习惯

▶ 发现 4 个显著差异的负荷阶段:
--------------------------------------------------------------------------------

【差异阶段 1】
  预测日阶段 2 ↔ 历史阶段 2
  时间范围:
    预测日: 10.0h-14.2h
    历史: 9.2h-14.0h
  ⏰ 时间偏移: +0.5 小时 (右移/推迟)
  📊 负荷变化:
    预测日负荷: 1.8165
    历史负荷: 0.8041
    变化量: +1.0124 (+125.9%)
    变化类型: 增加
  🔍 行为解释:
    • 上午时段负荷增加，可能是：在家办公、使用更多电器、或家庭成员未外出

【差异阶段 2】
  预测日阶段 5 ↔ 历史阶段 4
  时间范围:
    预测日: 18.8h-24.0h
    历史: 19.0h-24.0h
  📊 负荷变化:
    预测日负荷: 2.9300
    历史负荷: 2.3539
    变化量: +0.5761 (+24.5%)
    变化类型: 增加
  🔍 行为解释:
    • 晚高峰时段负荷增加，可能是：回家时间提前、晚餐准备更复杂、
      家庭娱乐活动增加、或使用更多照明和空调
```

**解读：**
- 与工作日相比，周日的上午负荷显著增加（+125.9%），说明在家时间明显增加
- 晚高峰负荷也有所增加（+24.5%），可能是家庭活动更丰富

#### 3. 跨时期行为模式总结

```
【跨时期行为模式总结】
================================================================================

• 与过去[1, 3, 7]天相比，负荷阶段数变化不一致，说明用电模式存在波动
• 与过去[1, 3, 7]天相比，负荷阶段时间偏移方向不一致，说明作息时间有波动
• 与历史时期相比，负荷整体呈上升趋势，可能原因：在家时间增加、
  新增用电设备、季节性需求上升

▶ 时间偏移趋势:
--------------------------------------------------------------------------------

与1天前相比:
  显著偏移阶段数: 3
  右移(推迟)阶段数: 2
  左移(提前)阶段数: 1
  主导方向: 右移(推迟)

与3天前相比:
  显著偏移阶段数: 2
  右移(推迟)阶段数: 1
  左移(提前)阶段数: 1
  主导方向: 混合

与7天前相比:
  显著偏移阶段数: 1
  右移(推迟)阶段数: 1
  左移(提前)阶段数: 0
  主导方向: 右移(推迟)
```

**解读：**
- 与不同历史时期相比，时间偏移方向不完全一致，说明作息时间在调整
- 总体上有右移（推迟）的趋势，符合周末作息推迟的特征

## 应用价值

通过这份报告，您可以：

1. **验证预测合理性** - 通过与历史对比，判断预测是否符合用户的实际行为模式
2. **理解用电行为** - 深入了解工作日/周末、季节等因素对用电的影响
3. **发现异常模式** - 及时发现与历史显著不同的用电模式
4. **优化能源管理** - 基于行为洞察，制定更有效的能源管理策略
5. **需求响应** - 为需求侧管理提供有价值的用户行为信息

## 后续操作

查看报告后，您可以：

1. 继续预测其他日期（系统会询问是否继续）
2. 分析JSON文件进行程序化处理
3. 对比不同日期的报告，发现长期趋势
4. 基于分析结果调整用电策略

## 注意事项

1. **历史数据要求** - 至少需要有1天前的历史数据才能进行对比
2. **数据质量** - 历史数据质量会影响对比分析的准确性
3. **解释的局限性** - 行为解释基于一般规律，实际情况可能因户而异
4. **时间一致性** - 确保预测日期在数据集的时间范围内

## 相关文档

- [预测模式中的多历史时期对比分析](PREDICTION_MODE_MULTI_HISTORICAL_COMPARISON.md) - 功能详细说明
- [多历史时期对比示例](MULTI_HISTORICAL_COMPARISON_EXAMPLE.md) - 更多示例
- [可解释性功能使用指南](README_INTERPRETABILITY.md) - 可解释性功能说明
