# 负荷变化可解释性模型架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     负荷变化可解释性模型架构                                  │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────────┐
│   输入数据源      │
├──────────────────┤
│ • 负荷时间序列    │
│ • 环境特征数据    │
│ • 时间戳         │
└────────┬─────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              特征提取层                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                  │
│  │  负荷特征     │    │  时间特征     │    │  环境特征     │                  │
│  ├──────────────┤    ├──────────────┤    ├──────────────┤                  │
│  │• 平滑值       │    │• 小时         │    │• 温度         │                  │
│  │• 均值         │    │• 分钟         │    │• 湿度         │                  │
│  │• 方差         │    │• 星期几       │    │• 云量         │                  │
│  │• 峰态         │    │• 是否周末     │    │• 气压         │                  │
│  │• 滞后特征     │    │               │    │• 风速         │                  │
│  │• FFT特征      │    │               │    │• 露点         │                  │
│  └──────────────┘    └──────────────┘    └──────────────┘                  │
│                                                                               │
└───────────────────────────────┬───────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          阶段划分层 (HMM)                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  输入: 负荷值序列                                                              │
│         ↓                                                                     │
│  ┌────────────────────────────────────────────────────┐                     │
│  │  高斯隐马尔可夫模型 (GaussianHMM)                   │                     │
│  │  • 自动选择最优状态数 (3-5个状态)                   │                     │
│  │  • 高自转移概率设置 (0.98)                          │                     │
│  │  • 中值滤波降噪                                     │                     │
│  └────────────────────────────────────────────────────┘                     │
│         ↓                                                                     │
│  ┌────────────────────────────────────────────────────┐                     │
│  │  后处理                                             │                     │
│  │  • 状态重新排序 (按平均负荷)                        │                     │
│  │  • 识别连续段                                       │                     │
│  │  • 合并短段 (< min_segment_length)                  │                     │
│  └────────────────────────────────────────────────────┘                     │
│         ↓                                                                     │
│  输出: states, state_means, segments                                         │
│                                                                               │
└───────────────────────────────┬───────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          可解释性分析层                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ 1. 阶段详细分析 (Segment Analysis)                                  │    │
│  │    • 负荷水平分类 (低/中低/中高/高)                                 │    │
│  │    • 时间段识别 (早高峰/白天/晚高峰/夜间)                           │    │
│  │    • 环境因素评估 (温度、湿度影响)                                  │    │
│  │    • 关键因素识别                                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│         ↓                                                                     │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ 2. 趋势变化分析 (Trend Analysis)                                    │    │
│  │    • 计算负荷变化量和变化率                                         │    │
│  │    • 判断变化趋势 (稳定/上升/下降/显著变化)                         │    │
│  │    • 时间转换解释                                                   │    │
│  │    • 生成自然语言解释                                               │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│         ↓                                                                     │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ 3. 特征重要性分析 (Feature Importance)                              │    │
│  │    • 计算Pearson相关系数                                            │    │
│  │    • 排序识别最重要特征                                             │    │
│  │    • 相关方向判断 (正/负相关)                                       │    │
│  │    • 量化影响程度                                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│         ↓                                                                     │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ 4. 环境因素综合评估 (Environmental Impact)                          │    │
│  │    • 统计各因素均值、标准差、范围                                   │    │
│  │    • 评估波动幅度                                                   │    │
│  │    • 识别异常条件                                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                               │
└───────────────────────────────┬───────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            输出层                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │  文本报告     │  │  JSON数据    │  │  可视化图表   │  │  结构化数据   │   │
│  ├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤   │
│  │• 阶段分析     │  │• 完整数据     │  │• 阶段柱状图   │  │• 段落信息     │   │
│  │• 趋势解释     │  │• 易于解析     │  │• 趋势折线图   │  │• 统计指标     │   │
│  │• 特征重要性   │  │• 程序调用     │  │• 相关性图     │  │• 特征数据     │   │
│  │• 环境影响     │  │               │  │• 雷达图       │  │               │   │
│  │               │  │               │  │• 叠加预测图   │  │               │   │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘   │
│                                                                               │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════

                              数据流向图

  负荷数据  ──┐
             ├──> 特征提取 ──> HMM分段 ──> 可解释性分析 ──┬──> 文本报告
  环境数据  ──┤                                           ├──> 可视化图表
             │                                           ├──> JSON数据
  时间戳   ──┘                                           └──> 结构化数据

═══════════════════════════════════════════════════════════════════════════════

                           关键算法流程

┌─────────────────────────────────────────────────────────────────────────────┐
│  HMM阶段划分算法                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  1. 输入: load_values[t], t=0..N-1                                           │
│  2. 预处理: reshape to (N, 1)                                                │
│  3. 状态数选择:                                                               │
│     for n_states in [min_states, max_states]:                               │
│         train HMM with n_states                                              │
│         score = hmm.score(load_values)                                       │
│         select n_states with best score                                      │
│  4. 训练最终模型:                                                             │
│     model = GaussianHMM(n_states)                                            │
│     model.transmat = high_self_transition_matrix                             │
│     model.fit(load_values)                                                   │
│  5. 预测状态:                                                                 │
│     raw_states = model.predict(load_values)                                  │
│  6. 降噪处理:                                                                 │
│     smoothed_states = median_filter(raw_states, size=5)                      │
│  7. 状态排序:                                                                 │
│     sort states by mean load value                                           │
│  8. 识别段落:                                                                 │
│     identify continuous segments                                             │
│  9. 合并短段:                                                                 │
│     merge segments < min_segment_length                                      │
│  10. 输出: states[], state_means[], segments[]                               │
│                                                                               │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  可解释性分析算法                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│  1. For each segment:                                                        │
│     a. 计算负荷水平分位数                                                     │
│     b. 分类为: 低/中低/中高/高负荷                                            │
│     c. 提取该段的特征统计                                                     │
│     d. 分析环境因素:                                                          │
│        - 温度影响 (< 10°C: 供暖, > 25°C: 空调)                               │
│        - 湿度影响 (> 70%: 除湿)                                              │
│        - 云量影响 (< 0.3: 自然采光)                                          │
│     e. 识别时间段:                                                            │
│        - 6-9h: 早高峰                                                        │
│        - 9-18h: 白天                                                         │
│        - 18-22h: 晚高峰                                                      │
│        - 22-6h: 夜间                                                         │
│     f. 生成关键因素列表                                                       │
│                                                                               │
│  2. For each segment transition:                                            │
│     a. 计算负荷变化: Δload = load[i+1] - load[i]                            │
│     b. 计算变化率: Δload% = (Δload / load[i]) * 100                         │
│     c. 判断趋势:                                                              │
│        - |Δload%| < 5%: 稳定                                                │
│        - Δload% > 30%: 显著上升                                             │
│        - Δload% < -30%: 显著下降                                            │
│        - else: 上升/下降                                                     │
│     d. 关联时间转换解释                                                       │
│                                                                               │
│  3. Feature importance:                                                      │
│     For each environmental feature:                                          │
│         corr = pearson_correlation(feature, load)                            │
│         sort by |corr| descending                                            │
│                                                                               │
│  4. Environmental impact:                                                    │
│     For each environmental feature:                                          │
│         compute mean, std, min, max, range                                   │
│                                                                               │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
```
